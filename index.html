<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stripe Test</title>
    <script src="https://js.stripe.com/terminal/v1/"></script>
  </head>
  <body>
    <h1>This is stripe test page</h1>
  </body>
  <script>
    function fetchConnectionToken() {
      // Your backend should call /v1/terminal/connection_tokens and return the JSON response from Stripe
      return fetch("http://localhost:3000/connection_token", {
        method: "POST",
      })
        .then(function (response) {
          console.log("response -----", response);
          return response.json();
        })
        .then(function (data) {
          console.log("data secret ------", data.secret);
          return data.secret;
        });
    }

    var terminal = StripeTerminal.create({
      onFetchConnectionToken: fetchConnectionToken,
      onUnexpectedReaderDisconnect: unexpectedDisconnect,
    });

    console.log("terminal ------", terminal);

    function unexpectedDisconnect() {
      // You might want to display UI to notify the user and start re-discovering readers
      alert("stripe disconnected");
    }

    // Handler for a "Connect Reader" button
    function connectReaderHandler() {
      var config = { simulated: true };
      terminal.discoverReaders(config).then(function (discoverResult) {
        if (discoverResult.error) {
          console.log("Failed to discover: ", discoverResult.error);
        } else if (discoverResult.discoveredReaders.length === 0) {
          console.log("No available readers.");
        } else {
          // Just select the first reader here.
          console.log("other way");
          var selectedReader = discoverResult.discoveredReaders[0];

          console.log("selectedReader -----", selectedReader);
          terminal.connectReader(selectedReader).then(function (connectResult) {
            if (connectResult.error) {
              console.log("Failed to connect: ", connectResult.error);
            } else {
              console.log("Connected to reader: ", connectResult.reader.label);
            }
          });
        }
      });
    }
    terminal.setSimulatorConfiguration({ testCardNumber: "4242424242424242" });

    connectReaderHandler();
  </script>
</html>
